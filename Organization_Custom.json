{
    "$id": "Organization_Custom.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Custom Organization Schema",
    "description": "Schema for defining custom organizations and their rule categorization structure",
    "$comment": "Version: 1.0.0, Last Updated: 2025-03-09",
    "properties": {
        "Organization": {
            "const": "SGS"
        },
        "Standards": {
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "properties": {
                    "Name": {
                        "type": "string",
                        "enum": [
                            "SGSIG",
                            "ARGX",
                            "CHIESI",
                            "DEBIO",
                            "JNJPH",
                            "LIGHTSGSIG",
                            "SANOFI",
                            "NAP"
                        ],
                        "description": "Name of the standard"
                    },
                    "Version": {
                        "type": "string",
                        "enum": [
                            "3.3",
                            "3.4",
                            "NAP"
                        ],
                        "description": "Version of the standard"
                    },
                    "Substandard": {
                        "type": "string",
                        "description": "Optional substandard name"
                    },
                    "References": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                            "type": "object",
                            "properties": {
                                "Citations": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "additionalProperties": false,
                                        "properties": {
                                            "Cited Guidance": {
                                                "type": "string"
                                            },
                                            "Document": {
                                                "const": "SGS"
                                            }
                                        }
                                    }
                                },
                                "Origin": {
                                    "type": "string",
                                    "enum": [
                                        "DM",
                                        "SD",
                                        "SD, DM"
                                    ],
                                    "description": "Origin of the rule (Department)"
                                },
                                "Rule Identifier": {
                                    "type": "object",
                                    "properties": {
                                        "Id": {
                                            "type": "string",
                                            "description": "Custom rule identifier pattern"
                                        },
                                        "Version": {
                                            "type": "string",
                                            "description": "Version of the rule"
                                        }
                                    },
                                    "required": [
                                        "Id"
                                    ]
                                }
                            },
                            "required": [
                                "Origin",
                                "Rule Identifier"
                            ]
                        }
                    }
                },
                "required": [
                    "Name",
                    "References",
                    "Version"
                ]
            }
        },
        "Category": {
            "description": "Custom categorization for rule governance",
            "properties": {
                "Sponsors": {
                    "type": "array",
                    "description": "List of sponsors the rule applies to",
                    "items": {
                        "$ref": "Sponsors.json"
                    }
                },
                "Vendors": {
                    "type": "array",
                    "description": "List of vendors the rule applies to",
                    "items": {
                        "$ref": "Vendors.json"
                    }
                },
                "TherapeuticAreas": {
                    "type": "array",
                    "description": "List of therapeutic areas the rule applies to",
                    "items": {
                        "$ref": "TherapeuticAreas.json"
                    }
                },
                "Trials": {
                    "type": "array",
                    "description": "trials",
                    "items": {
                        "$ref": "Trials.json"
                    }
                },
                "Purpose": {
                    "type": "string",
                    "enum": [
                        "Conformance",
                        "External Data",
                        "Data Review",
                        "Validation"
                    ],
                    "description": "Specific purpose of the rule"
                },
                "CompanyRuleLibrary": {
                    "type": "boolean",
                    "const": true,
                    "description": "Whether the rule is part of a company rule library"
                },
                "OutputType": {
                    "type": "string",
                    "enum": [
                        "Check",
                        "Listing"
                    ],
                    "description": "Output type of the rule validation result"
                },
                "Keywords": {
                    "type": "array",
                    "description": "Custom keywords for further categorization",
                    "items": {
                        "type": "string"
                    }
                },
                "GeneralDescription": {
                    "type": "string",
                    "description": "The general description for a rule in plain language (free text)"
                },
                "QcStage": {
                    "type": "boolean",
                    "enum": [
                        true,
                        false
                    ],
                    "description": "Whether the rule should run on data in QC Stage"
                },
                "LiveStage": {
                    "type": "boolean",
                    "enum": [
                        true,
                        false
                    ],
                    "description": "Whether the rule should run on data in Live Stage"
                },
                "BlindedData": {
                    "type": "boolean",
                    "enum": [
                        true,
                        false
                    ],
                    "description": "Whether the rule should run on blinded data"
                },
                "Source": {
                    "type": "string",
                    "enum": [
						"RAW",
						"SDTM",
						"RAW, SDTM"
					],
                    "description": "Type of source data for the rule"
                },
                "KeepDeletedRows": {
                    "type": "boolean",
                    "enum": [
                        true,
                        false
                    ],
                    "description": "Whether deleted records should be kept in the rule output"
                },
                "MandatoryReplace": {
                    "type": "boolean",
                    "enum": [
                        true,
                        false
                    ],
                    "description": "Whether it is mandatory to replace the rule when a higher version becomes available"
                }
            },
            "additionalProperties": false,
            "required": [
                "Sponsors",
                "Trials",
                "TherapeuticAreas",
                "Purpose",
                "OutputType",
                "GeneralDescription"
            ],
			
				"allOf": [
				{
					"if": {
						"properties": { "Purpose": { "const": "External Data" } }
					},
					"then": {
						"required": ["Vendors"]
					}
				},
				{
					"if": {
						"properties": { "Purpose": { "const": "Validation" } }
					},
					"then": {
						"properties": {
							"KeepDeletedRows": { "const": true }
						},
					"required": ["KeepDeletedRows"]
					}
				},
				{
					"if": {
						"properties": { "Purpose": { "const": "Data Review" } }
					},
					"then": {
						"properties": {
							"MandatoryReplace": { "const": false }
						},
					"required": ["MandatoryReplace"]
					}
				}				
				]
			

        }
    },
    "required": [
        "Organization",
        "Standards",
        "Category"
    ],
    "type": "object",
    "$defs": {
	"metadata": {
          "schemaVersion": "0.0.1",
          "releaseDate": "2025-05-23",
          "changelog": [
            {
              "version": "0.0.1",
              "date": "2025-05-23",
              "description": "Draft release of Custom Organization Schema",
              "changes": [
                "Changed attributes in Organization",
				"Changed attributes in Standards",
				"Added Category object structure with standard properties, including support for Sponsors, TherapeuticAreas and Trials (general values)"
              ]
            },
			            {
              "version": "0.0.2",
              "date": "2025-09-17",
              "description": "Draft release of Custom Organization Schema",
              "changes": [
                "Added Standards (SGS, ARGX, CHIESI, DEBIO, JNJ, LIGHTSGS, SANOFI, NAP)",
				"Added version NAP",
				"Added Validation as possible purpose",
				"Added link to vendors in SAMS",
				"Added Category properties GeneralDescription, QcStage, LiveStage, BlindedData, Source, KeepDeletedRows, Mandatory"
              ]
            }
          ],
          "maintainer": {
            "name": "SGS",
            "email": "chris.fransen@sgs.com"
          }
        }
    }

}
